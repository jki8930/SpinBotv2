<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRGSpin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-100">
    <div id="app" class="p-4">
        <div class="flex border-b">
            <button class="px-4 py-2 -mb-px font-semibold text-gray-800 border-b-2 border-pink-500" data-tab="wheel">üé∞ –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</button>
            <button class="px-4 py-2 font-semibold text-gray-500" data-tab="leaderboard">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</button>
            <button class="px-4 py-2 font-semibold text-gray-500" data-tab="referrals">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
        </div>
        <div id="wheel" class="py-4">
            <div class="flex flex-col items-center">
                <div id="wheel-container" class="w-64 h-64 rounded-full flex items-center justify-center mb-4 relative">
                    <!-- Sectors will be generated here -->
                </div>
                <button id="spin-button" class="px-6 py-2 bg-pink-500 text-white font-bold rounded-full">–í—Ä–∞—â–∞—Ç—å</button>
            </div>
        </div>
        <div id="leaderboard" class="hidden py-4">
            <h2 class="text-2xl font-bold">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
            <!-- Leaderboard component will go here -->
        </div>
        <div id="referrals" class="hidden py-4">
            <h2 class="text-2xl font-bold">–†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
            <!-- Referrals component will go here -->
        </div>
    </div>
    <script>
        const tabs = document.querySelectorAll('[data-tab]');
        const tabContents = document.querySelectorAll('[id^="wheel"], [id^="leaderboard"], [id^="referrals"]');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('border-pink-500', 'text-gray-800'));
                tab.classList.add('border-pink-500', 'text-gray-800');

                tabContents.forEach(content => {
                    if (content.id === tab.dataset.tab) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            });
        });

        const wheelContainer = document.getElementById('wheel-container');
        const spinButton = document.getElementById('spin-button');

        let prizes = [];

        async function fetchPrizes() {
            const response = await fetch('/api/wheel/prizes');
            prizes = await response.json();
            createWheel();
        }

        function createWheel() {
            const totalChance = prizes.reduce((acc, prize) => acc + prize.chance, 0);
            let currentAngle = 0;
            const gradientColors = [];

            prizes.forEach((prize, index) => {
                const prizeAngle = (prize.chance / totalChance) * 360;
                const color = index % 2 === 0 ? '#fce7f3' : '#fbcfe8';
                gradientColors.push(`${color} ${currentAngle}deg ${currentAngle + prizeAngle}deg`);

                const prizeElement = document.createElement('div');
                prizeElement.className = 'absolute w-full h-full';
                prizeElement.style.transform = `rotate(${currentAngle + prizeAngle / 2}deg)`;
                prizeElement.innerHTML = `<span class="absolute top-0 left-1/2 -translate-x-1/2 text-xs">${prize.name}</span>`;
                wheelContainer.appendChild(prizeElement);

                currentAngle += prizeAngle;
            });

            wheelContainer.style.background = `conic-gradient(${gradientColors.join(', ')})`;
        }

        spinButton.addEventListener('click', () => {
            const totalChance = prizes.reduce((acc, prize) => acc + prize.chance, 0);
            let randomValue = Math.random() * totalChance;
            let winningPrize = null;

            for (const prize of prizes) {
                randomValue -= prize.chance;
                if (randomValue <= 0) {
                    winningPrize = prize;
                    break;
                }
            }

            const prizeAngle = (winningPrize.chance / totalChance) * 360;
            const winningAngle = 360 - (prizes.indexOf(winningPrize) * prizeAngle + prizeAngle / 2);

            wheelContainer.style.transition = 'transform 3s ease-out';
            wheelContainer.style.transform = `rotate(${360 * 5 + winningAngle}deg)`;

            setTimeout(() => {
                alert(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${winningPrize.name}`);
                wheelContainer.style.transition = 'none';
                wheelContainer.style.transform = `rotate(${winningAngle}deg)`;
            }, 3000);
        });

        fetchPrizes();
    </script>
</body>
</html>
